# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do
  desc "Description of what the lane does"
  lane :test_badge do
    add_badge(shield: "0.3-TEST-black", no_badge: true)
  end

  desc "Tag the main branch, e.g. bundle exec fastlane tag version:0.1.0 repo:eudi-lib-ios-iso18013-data-transfer"
  lane :tag do |options|
    sh "gh auth login --with-token < ~/.github_token_eudi"
    # fastlane action to tag git
    tag_version = options[:version]
    cmdline = "gh release create v#{tag_version} -R eu-digital-identity-wallet/#{options[:repo]} -t 'Snapshot #{tag_version}'"
    if options[:commit_sha]; cmdline += " --target #{options[:commit_sha]}"; end
    sh cmdline
  end

end
